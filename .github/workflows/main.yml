name: Generate Gherkin Test Cases

on:
  workflow_dispatch:
    inputs:
      REQUIREMENT:
        description: "Requirement (in natural language)"
        required: true
      SQUAD:
        description: "Squad name (e.g., squad-auth)"
        required: true
      FILE_NAME:
        description: "Custom file name (optional)"
        required: false
      TAG:
        description: "Priority (P0, P1, etc.)"
        required: false
      OTHER_TAGS:
        description: "Other tags (e.g., smoke, login)"
        required: false
      BACKGROUND:
        description: "App Background"
        required: false
        default: "Talabat food application"
      ADDITIONAL_BACKGROUND:
        description: "Additional Background (e.g., logged in user)"
        required: false

jobs:
  generate-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      - name: Run test case generator
        env:
          GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_REPO_OWNER: ${{ github.repository_owner }}
          GITHUB_REPO_NAME: ${{ github.event.repository.name }}
          GITHUB_BRANCH: ${{ github.ref_name }}
        run: |
          python cli.py \
            --requirement "${{ github.event.inputs.REQUIREMENT }}" \
            --squad "${{ github.event.inputs.SQUAD }}" \
            --file-name "${{ github.event.inputs.FILE_NAME }}" \
            --tag "${{ github.event.inputs.TAG }}" \
            --other-tags "${{ github.event.inputs.OTHER_TAGS }}" \
            --background "${{ github.event.inputs.BACKGROUND }}" \
            --additional-background "${{ github.event.inputs.ADDITIONAL_BACKGROUND }}"
